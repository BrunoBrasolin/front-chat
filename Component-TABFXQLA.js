var d=(o,c,e)=>new Promise((n,a)=>{var m=r=>{try{h(e.next(r))}catch(p){a(p)}},M=r=>{try{h(e.throw(r))}catch(p){a(p)}},h=r=>r.done?n(r.value):Promise.resolve(r.value).then(m,M);h((e=e.apply(o,c)).next())});import"@angular/core";var s=function(o){return o.User="user",o.Chatbot="chatbot",o}(s||{});import{FormControl as _,ReactiveFormsModule as O,Validators as P}from"@angular/forms";import{CommonModule as v}from"@angular/common";import{finalize as C}from"rxjs";import*as t from"@angular/core";import*as i from"@angular/forms";import"@angular/core";import*as g from"@angular/core";import*as u from"@angular/common/http";var b=(()=>{class o{constructor(e){this.http=e,this.audioContext=null,this.mediaRecorder=null,this.audioChunks=[]}sendUserMessage(e){return this.http.post("https://api.gamidas.dev.br/chat/message",e)}startRecording(){return d(this,null,function*(){this.audioContext=new(window.AudioContext||window.webkitAudioContext);let e=yield navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(e),this.mediaRecorder.ondataavailable=n=>{this.audioChunks.push(n.data)},this.mediaRecorder.start()})}stopRecording(){return new Promise(e=>{this.mediaRecorder&&this.audioContext&&(this.mediaRecorder.onstop=()=>{let n=new Blob(this.audioChunks,{type:"audio/wav"});this.audioChunks=[],this.audioContext?.close(),this.audioContext=null,e(n)},this.mediaRecorder.stop())})}transcriptAudio(e){let n=new FormData;return n.append("audio",e,"recording.wav"),this.http.post("https://api.gamidas.dev.br/chat/transcript_audio",n)}static{this.\u0275fac=function(n){return new(n||o)(g.\u0275\u0275inject(u.HttpClient))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();import*as l from"@angular/common";function x(o,c){if(o&1&&(t.\u0275\u0275elementStart(0,"div")(1,"div",12)(2,"span",13),t.\u0275\u0275text(3),t.\u0275\u0275elementEnd()()()),o&2){let e=c.$implicit;t.\u0275\u0275classMapInterpolate1("message-content ",e.sender,""),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",e.message," ")}}function y(o,c){if(o&1&&(t.\u0275\u0275elementStart(0,"div")(1,"div",12)(2,"span",13)(3,"div",14),t.\u0275\u0275element(4,"div",15)(5,"div",15)(6,"div",15),t.\u0275\u0275elementEnd()()()()),o&2){let e=t.\u0275\u0275nextContext();t.\u0275\u0275classMapInterpolate1("message-content ",e.loading.owner,"")}}var E=(()=>{class o{constructor(e,n){this.formBuilder=e,this.service=n,this.loading={owner:s.Chatbot,loading:null},this.userInput=new _("",[P.required]),this.messages=[],this.chatForm=this.formBuilder.group({userInput:this.userInput}),this.isRecording=!1}toggleRecording(){return d(this,null,function*(){if(this.isRecording){this.isRecording=!1;let e=yield this.service.stopRecording();if(!e){this.addMessage(s.Chatbot,"N\xE3o entendi, poderia repetir?");return}this.setUserLoading(!0),this.service.transcriptAudio(e).pipe(C(()=>{this.setUserLoading(!1)})).subscribe(n=>{if(console.log(n),!n.message){this.addMessage(s.User,""),this.addMessage(s.Chatbot,"N\xE3o entendi, poderia repetir?");return}this.sendUserMessage(n.message)})}else{this.isRecording=!0;try{yield this.service.startRecording()}catch{this.addMessage(s.Chatbot,"Ocorreu um erro na grava\xE7\xE3o do seu \xE1udio.")}}})}handleMessageSent(){let e=this.userInput.value;if(e==null||e==""){alert("Favor informar uma mensagem.");return}this.sendUserMessage(e)}sendUserMessage(e){this.setBotLoading(!0);try{this.userInput.setValue(""),this.addMessage(s.User,e);let n={message:e,language:"portuguese"};this.service.sendUserMessage(n).pipe(C(()=>{this.setBotLoading(!1)})).subscribe(a=>{this.setBotLoading(!1),this.addMessage(s.Chatbot,a.message)})}catch{this.addMessage(s.Chatbot,"Ocorreu um erro, poderia tentar novamente?"),this.setBotLoading(!1)}}setBotLoading(e){this.loading={owner:s.Chatbot,loading:e}}setUserLoading(e){this.loading={owner:s.User,loading:e}}addMessage(e,n){this.messages.push({sender:e,message:n}),setTimeout(()=>{document.querySelector("#chatEnd")?.scrollIntoView({behavior:"smooth"})},1)}static{this.\u0275fac=function(n){return new(n||o)(t.\u0275\u0275directiveInject(i.FormBuilder),t.\u0275\u0275directiveInject(b))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["app-root"]],standalone:!0,features:[t.\u0275\u0275StandaloneFeature],decls:14,vars:8,consts:[[1,"chatbot-content"],[1,"chatbot-header"],[1,"chatbot-title"],[1,"chatbot-body"],[3,"class",4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],["id","chatEnd"],[1,"chatbot-footer",3,"ngSubmit","formGroup"],["type","button",3,"click","disabled"],["src","assets/icons/microphone.png","alt","Microphone"],["type","text","formControlName","userInput","placeholder","Digite sua mensagem...",1,"chatbot-input"],["type","submit",1,"chatbot-send",3,"disabled"],[1,"message"],[1,"text"],[1,"loading-dots"],[1,"dot"]],template:function(n,a){n&1&&(t.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"span",2),t.\u0275\u0275text(3,"dalme"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(4,"div",3),t.\u0275\u0275template(5,x,4,4,"div",4)(6,y,7,3,"div",5),t.\u0275\u0275element(7,"div",6),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(8,"form",7),t.\u0275\u0275listener("ngSubmit",function(){return a.handleMessageSent()}),t.\u0275\u0275elementStart(9,"button",8),t.\u0275\u0275listener("click",function(){return a.toggleRecording()}),t.\u0275\u0275element(10,"img",9),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(11,"input",10),t.\u0275\u0275elementStart(12,"button",11),t.\u0275\u0275text(13,"Enviar"),t.\u0275\u0275elementEnd()()()),n&2&&(t.\u0275\u0275advance(5),t.\u0275\u0275property("ngForOf",a.messages),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",a.loading.loading),t.\u0275\u0275advance(2),t.\u0275\u0275property("formGroup",a.chatForm),t.\u0275\u0275advance(),t.\u0275\u0275classMapInterpolate1("chatbot-microphone ",a.isRecording?"recording":"",""),t.\u0275\u0275property("disabled",a.loading.loading),t.\u0275\u0275advance(3),t.\u0275\u0275property("disabled",a.loading.loading))},dependencies:[O,i.\u0275NgNoValidate,i.DefaultValueAccessor,i.NgControlStatus,i.NgControlStatusGroup,i.FormGroupDirective,i.FormControlName,v,l.NgForOf,l.NgIf],styles:["@keyframes _ngcontent-%COMP%_dotUp{0%,to{transform:translateY(0)}50%{transform:translateY(-2.3333333333px)}}@keyframes _ngcontent-%COMP%_dotMiddle{0%,to{transform:translateY(0)}50%{transform:translateY(-2.3333333333px)}}@keyframes _ngcontent-%COMP%_dotDown{0%,to{transform:translateY(0)}50%{transform:translateY(-2.3333333333px)}}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(.9);box-shadow:0 0 #000000b3}70%{transform:scale(1);box-shadow:0 0 0 10px #0000}to{transform:scale(.9);box-shadow:0 0 #0000}}.chatbot-content[_ngcontent-%COMP%]{height:100%;width:100%;max-width:1366px;margin:0 auto;display:flex;flex-direction:column;color:#1e1a1d}.chatbot-content[_ngcontent-%COMP%]   .chatbot-header[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:60px;background-color:gold;font-size:2rem;column-gap:1rem}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin-bottom:28px}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{position:relative;max-width:70%}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background-color:gold;border-radius:5px;white-space:pre-line;display:flex;padding:10px}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .loading-dots[_ngcontent-%COMP%]{display:flex;align-items:center;column-gap:3.5px;margin:0 1rem}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .loading-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:7px;height:7px;background-color:#1e1a1d;border-radius:50%;display:inline-block;animation-duration:1s;animation-timing-function:ease-in-out;animation-iteration-count:infinite}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .loading-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(1){animation-name:_ngcontent-%COMP%_dotUp;animation-delay:0s}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .loading-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(2){animation-name:_ngcontent-%COMP%_dotMiddle;animation-delay:.3333333333s}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .loading-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(3){animation-name:_ngcontent-%COMP%_dotDown;animation-delay:.6666666667s}.chatbot-content[_ngcontent-%COMP%]   .chatbot-body[_ngcontent-%COMP%]   .message-content.user[_ngcontent-%COMP%]{justify-content:flex-end}.chatbot-content[_ngcontent-%COMP%]   .chatbot-footer[_ngcontent-%COMP%]{display:flex;padding:1rem;border-top:1px solid #e0e0e0}.chatbot-content[_ngcontent-%COMP%]   .chatbot-footer[_ngcontent-%COMP%]   .chatbot-microphone[_ngcontent-%COMP%]{border:none;background-color:gold;border-radius:50%;cursor:pointer;transition:.25s;height:2.5rem;width:2.5rem;padding:.45rem}.chatbot-content[_ngcontent-%COMP%]   .chatbot-footer[_ngcontent-%COMP%]   .chatbot-microphone[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:contain;width:100%;height:100%}.chatbot-content[_ngcontent-%COMP%]   .chatbot-footer[_ngcontent-%COMP%]   .chatbot-microphone.recording[_ngcontent-%COMP%]{box-shadow:0 0 #000;transform:scale(1);animation:_ngcontent-%COMP%_pulse 1.5s infinite}.chatbot-content[_ngcontent-%COMP%]   .chatbot-footer[_ngcontent-%COMP%]   .chatbot-input[_ngcontent-%COMP%]{flex:1;margin:0 10px;padding:10px;border:1px solid #e0e0e0;border-radius:5px;text-transform:none}.chatbot-content[_ngcontent-%COMP%]   .chatbot-footer[_ngcontent-%COMP%]   .chatbot-send[_ngcontent-%COMP%]{padding:10px 15px;background-color:gold;cursor:pointer;border:none;border-radius:5px}.chatbot-content[_ngcontent-%COMP%]   .chatbot-footer[_ngcontent-%COMP%]   .chatbot-send[_ngcontent-%COMP%]:hover{background-color:#fad300}"]})}}return o})();export{E as AppComponent};
